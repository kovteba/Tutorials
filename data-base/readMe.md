# DATA BASE

- [ANSI SQL](#ANSI-SQL)
- [Основные элементы баз данных](#Основные-элементы-баз-данных)
- [NULL в базах данных](#NULL-в-базах-данных)
- [Нормализация](#Нормализация)
- [Денормализация](#Денормализация)
- [Первая нормальная форма](#Первая-нормальная-форма)
- [Вторая нормальная форма](#Вторая-нормальная-форма)
- [Третья нормальная форма](#Третья-нормальная-форма)
- [MySQL vs PostgreSQL](#MySQL-vs-PostgreSQL)
    - [История разработки MySQL и PostgreSQL](#История-разработки-MySQL-и-PostgreSQL)
    - [Особенности хранения данных](#Особенности-хранения-данных)
    - [Стандарты SQL](#Стандарты-SQL)
    - [Возможности обработки данных](#Возможности-обработки-данных)
    - [Производительность MySQL и Postgresql](#Производительность-MySQL-и-Postgresql)
    - [Поддерживаемые типы данных](#Поддерживаемые-типы-данных)
    - [Будущее MySQL и Postgresql](#Будущее-MySQL-и-Postgresql)
- [СУБД](#СУБД)
- [Целостность данных](#Целостность-данных)
- [ACID](#ACID)
- [](#)
---
- [PRACTICE](src/main/java/kovteba/practice)

## ANSI SQL
[__SQL__](src/main/java/kovteba/sql) (_structured query language_ — «язык структурированных запросов») — 
формальный непроцедурный язык программирования, применяемый для создания, модификации и управления данными в 
произвольной реляционной базе данных, управляемой соответствующей системой управления базами данных (СУБД). 
SQL основывается на исчислении __кортежей__.   
Стандарт SQL определяется с помощью кода `ANSI`.

## Основные элементы баз данных
__Поле__ — это минимальный элемент базы данных, содержащий один неделимый квант информации. Каждое поле 
характеризуется _именем_ и _типом_ хранящихся в нем данных.  

__Запись__ — это совокупность нескольких разнородных полей, описывающая некоторую сущность предметной области.
Таблица базы данных — это набор однородных записей.  

__Хранимая процедура__ — объект базы данных, представляющий собой набор _SQL_-инструкций, который компилируется 
один раз и хранится на сервере. Хранимые процедуры очень похожи на обыкновенные процедуры языков высокого уровня, 
у них могут быть входные и выходные параметры и локальные переменные, в них могут производиться числовые вычисления 
и операции над символьными данными, результаты которых могут присваиваться переменным и параметрам. В хранимых 
процедурах могут выполняться стандартные операции с базами данных (как `DDL`, так и `DML`). Кроме того, в хранимых 
процедурах возможны циклы и ветвления, то есть в них могут использоваться инструкции управления процессом исполнения.
```sql
CREATE [OR REPLACE] PROCEDURE имя_процедуры
[ (параметр [, параметр, …]) ] IS
            [локальные объявления]
        BEGIN
            исполняемые предложения
        [EXCEPTION
            обработчики исключений]
        END [имя_процедуры];
```
__Функция__ – это подпрограмма, которая вычисляет значение. Существует большое количество встроенных функций 
(могут разниться для разных БД).
```sql
CREATE [OR REPLACE] FUNCTION имя_функции
[ (параметр [, параметр, …]) ]
RETURN тип_данных IS | AS
            [локальные объявления]
        BEGIN
            исполняемые предложения
        [EXCEPTION
            обработчики исключений]
        END [имя_функции];
```
__Констрейнты__ (constraints) — объявление правил (ограничения), которым должны соответствовать данные в таблице.
```sql
CREATE TABLE table_name
(
column_name1 data_type(size) constraint_name,
column_name2 data_type(size) constraint_name,
column_name3 data_type(size) constraint_name,
....
);
Например для задания первичного ключа, можно использовать такую запись:
CONSTRAINT <имя ограничения> PRIMARY KEY (<список столбцов, являющихся первичным ключом>)
```
__Типы констрейнтов:__  
- `NOT NULL` -колонка не может содержать NULL значений.
- `UNIQUE` — каждая строка в колонке должна иметь уникальное значение.
- `PRIMARY KEY` — комбинация NOT NULL и UNIQUE.
- `FOREIGN KEY` — обеспечивает ссылочную целостность. Означает что ссылающиеся данные имеют соответствие в другой таблице.
- `CHECK` — проверка на определенное выполнение правил.
- `DEFAULT` — задает значение по умолчанию для колонки

## NULL в базах данных
Смысл `NULL`-значения — это отсутствие информации или неприменимость данного атрибута в данном кортеже.   
NULL-значение может означать неприменимость значения к этому столбцу (например в колонке «скорость полета» 
для таблицы животные и записи «Слон»)   
`NULL`-значение так же может означать отсутствие информации. Заменять отсутствующие значения, например на `-1`, `‘ ‘` 
или что-то такое, не корректно.

## Нормализация
Нормализацией схемы базы данных называется процедура, производимая над базой данных с целью удаления в ней избыточности.
Нормализация несет с собой немало преимуществ. Очевидно, что в нормализованной базе данных уменьшается вероятность 
возникновения ошибок, она занимает меньше места на жестком диске и т.д.

__Нормализация__ — процесс организации данных, цель которого избежать дублирования и избыточности. 

Некоторые из преимуществ:   
- Лучшая организация базы данных
- Больше таблиц с небольшими строками
- Эффективный доступ к данным
- Большая гибкость для запросов
- Быстрый поиск информации
- Проще реализовать безопасность данных
- Позволяет легко модифицировать
- Сокращение избыточных и дублирующихся данных
- Более компактная база данных
- Обеспечивает согласованность данных после внесения изменений

## Денормализация
__Денормализация__ — техника, которая используется для преобразования из высших к низшим нормальным формам. 
Она помогает разработчикам баз данных повысить производительность всей инфраструктуры, поскольку вносит 
избыточность в таблицу. Она добавляет избыточные данные в таблицу, учитывая частые запросы к базе данных, 
которые объединяют данные из разных таблиц в одну таблицу.

## Первая нормальная форма
Отношение находится в __1НФ__, если все его атрибуты являются простыми, все используемые домены должны содержать только 
скалярные значения. Не должно быть повторений строк в таблице.   
Например, есть таблица «Автомобили»:
![1nferror](img/1nferror.png)   
Нарушение нормализации 1НФ происходит в моделях BMW, т.к. в одной ячейке содержится список из 3 
элементов: M5, X5M, M1, т.е. он не является атомарным. Преобразуем таблицу к 1НФ:
![1nfright](img/1nfright.png)   

## Вторая нормальная форма
Отношение находится во __2НФ__, если оно находится в __1НФ__ и каждый не ключевой атрибут неприводимо зависит от 
Первичного Ключа(ПК).

Неприводимость означает, что в составе потенциального ключа отсутствует меньшее подмножество атрибутов, от которого 
можно также вывести данную функциональную зависимость.

Например, дана таблица: 
![2nferror](img/2nferror.png)    
Таблица находится в первой нормальной форме, но не во второй. Цена машины зависит от модели и фирмы. Скидка зависят 
от фирмы, то есть зависимость от первичного ключа неполная. Исправляется это путем декомпозиции на два отношения, 
в которых не ключевые атрибуты зависят от ПК.
![2nfright1](img/2nfright1.png)   
![2nfright2](img/2nfright2.png)

## Третья нормальная форма
Отношение находится в __3НФ__, когда находится во __2НФ__ и каждый не ключевой атрибут нетранзитивно зависит от 
первичного ключа. Проще говоря, второе правило требует выносить все не ключевые поля, содержимое которых может 
относиться к нескольким записям таблицы в отдельные таблицы.

Рассмотрим таблицу:
![2nfnot3nf](img/2nfno3nf.png)
Таблица находится во _2НФ_, но не в _3НФ_.
В отношении атрибут «Модель» является первичным ключом. Личных телефонов у автомобилей нет, и телефон зависит 
исключительно от магазина.  
Таким образом, в отношении существуют следующие функциональные зависимости: Модель → Магазин, Магазин → Телефон, 
Модель → Телефон.  
Зависимость Модель → Телефон является транзитивной, следовательно, отношение не находится в 3НФ.  
В результате разделения исходного отношения получаются два отношения, находящиеся в 3НФ:  
![3nfright1](img/3nfright1.png)
![3nfright2](img/3nfright2.png)

## MySQL vs PostgreSQL
### История разработки MySQL и PostgreSQL
MySQL начал создаваться еще в 90-х. Внутренний выпуск произошел в 1995 году. Тогда разработкой MySQL занимались 
несколько компаний. Начиная с 2010 года компания  Oracle владеет проектом MySQL и разрабатывает новые версии.

PostgreSQL немного ранее в 1986 году начал разрабатываться в Калифорнийском университете.  Над проектом работали 
более 8 лет, но потом был разделен на коммерческую БД IIlustra и свободный проект Postrgesql.

### Особенности хранения данных
В MySQL для хранения данных в таблицах используются различные движки. Движок не имеет влияния на синтаксис 
запросов и их выполнение. Имеется поддержка MyISAM, InnoDB, MEMORY, Berkeley DB. Их основное отличие в 
способе записи данных на диск и методов считывания.   
PostgreSQL работает только на движке storage engine. Таблицы организованы в виде обьектов, а действия 
выполняются с помощью объективно ориентированных функций.

### Стандарты SQL
__SQL__ - это стандартизированный язык выполнения запросов, который используется и _MySQL_ и _PostgreSQL_. 
Этот стандарт имеет несколько версий и был разработан еще в 1986 году.

MySQL имеет поддержку не всех функций и возможностей SQL. Это сделано для того, чтобы работать с MySQL 
было просто и удобно. Но если для проекта необходимо какое-то расширение, разработчики его могут 
добавить не в ущерб стандарту.

PostgreSQL поддерживает все новые стандарты SQL, из-за этого данный проект довольно сложный и не 
настолько популярный как MySQL.

### Возможности обработки данных
MySQL при исполнении запроса делает загрузку всего ответа сервера в память клиента. В случае больших 
обьемов это не всегда удобно. По функциям Postgresql более широкий чем Mysql. Например, в Postgresql 
при помощи курсора можно перемещать полученные данные. Вам предоставляется только указатель, а весь 
ответ хранится в памяти сервера баз данных. Данный указатель можно хранить между сеансами. Postgresql 
имеет поддержку регулярных выражений в запросах, рекурсивных запросов и наследования таблиц.

В PostgreSQL вы можете использовать курсоры. Представьте, что некоторый запрос возвращает гигабайт данных. 
Вы вынуждены передать весь этот гигабайт по сети (если СУБД работает на отдельном сервере) и сохранить его 
в памяти перед тем, как что-то с ним делать. Даже если используемый вами драйвер поддерживает функции типа 
fetch_next_row, в действительности он все равно сначала кладет весь результат выполнения запроса в память. 
С помощью курсоров вы можете не только забирать данные кусками, тем самым обрабатывая их в постоянном объеме 
памяти, но и свободно перемещаться по ним в разные стороны. Например, вы можете прочитать первые 100 строк, 
потом посмотреть 10001-ую, и в зависимости от ее значения перейти к последней строке или вообще закрыть курсор.

### Производительность MySQL и Postgresql
MySQL всегда был ориентирован на большую производительность, в то время как Postgresql был нацелен на 
большое количество настроек и стандартов. Но со временем эта ситуация поменялась и Postgre стал 
более производительным.

Для организации работы с базой данных в MySQL используется таблица InnoDB. А это значит, что MySQL будет 
значительно быстрее Postgre в случае использовании первичного ключа.

По поводу  Postgresql, вся заголовочная информация таблиц размещается в оперативной памяти. Можно применять 
несколько индексов к одной таблице для большего удобства. В общем PostgreSQL работает быстрее, кроме 
ситуаций с использованием первичных ключей.

### Поддерживаемые типы данных 
MySQL и Postgresql имеют похожий набор, который, конечно же, имеет свои отличия. В Postgre типы более 
разнообразны и есть свои типы полей для определенных видов данных, которых, например, нет в MySQL.

### Будущее MySQL и Postgresql
Эти проекты имеют открытый исходный код, но развиваются совсем по-разному. MySQL под руководством 
компании Oracle тормозит в развитии. Postgresql развивается группой программистов и несколькими 
компаниями. Новые версии выходят достаточно часто и имеют новые функции.

## СУБД
__База данных__ — структурированная коллекция данных.   

__Система управления базами данных (СУБД)__ — программное обеспечение, которое взаимодействует с пользователем, 
приложениями и самой базой данных для сбора и анализа данных. СУБД позволяет пользователю взаимодействовать с 
базой данных. Данные, хранящиеся в базе данных, могут быть изменены, извлечены и удалены. Они могут быть любых 
типов, таких как строки, числа, изображения и т. д.

__Существует два типа СУБД:__    
- Реляционная система управления базами данных: данные хранятся в отношениях (таблицах). Пример — MySQL.
- Нереляционная система управления базами данных: не существует понятия отношений, кортежей и атрибутов. Пример — Mongo.

## Целостность данных
Целостность данных определяет точность, а также согласованность данных, хранящихся в базе данных. Она также 
определяет ограничения целостности для обеспечения соблюдения бизнес-правил для данных, когда они вводятся в 
приложение или базу данных.

## ACID
__ACID__ означает атомарность (Atomicity), согласованность (Consistency), изолированность (Isolation), 
долговечность (Durability). Он используется для обеспечения надежной обработки транзакций данных в 
системе базы данных.

__Атомарность__    
Гарантирует, что транзакция будет полностью выполнена или потерпит неудачу, где транзакция представляет 
одну логическую операцию данных. Это означает, что при сбое одной части любой транзакции происходит сбой 
всей транзакции и состояние базы данных остается неизменным.

__Согласованность__     
Гарантирует, что данные должны соответствовать всем правилам валидации. Проще говоря, вы можете сказать, 
что ваша транзакция никогда не оставит вашу базу данных в недопустимом состоянии.

__Изолированность__     
Основной целью изолированности является контроль механизма параллельного изменения данных.

__Долговечность__     
Долговечность подразумевает, что если транзакция была подтверждена `COMMIT`, произошедшие в рамках 
транзакции изменения сохранятся независимо от того, что может встать у них на пути (например, 
потеря питания, сбой или ошибки любого рода).
















