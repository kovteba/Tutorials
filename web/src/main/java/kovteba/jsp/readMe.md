# JSP

- [Что такое Java Server Pages (JSP)?](#Что-такое-Java-Server-Pages-(JSP)?)
- [Зачем нужен JSP?](#Зачем-нужен-JSP?)
- [Опишите, как обрабатываются JSP страницы, начиная от запроса к серверу, заканчивая ответом пользователю.](#Опишите,-как-обрабатываются-JSP-страницы,-начиная-от-запроса-к-серверу,-заканчивая-ответом-пользователю.)
- [Расскажите об этапах (фазах) жизненного цикла JSP.](#Расскажите-об-этапах-(фазах)-жизненного-цикла-JSP.)
- [Расскажите о методах жизненного цикла JSP.](#Расскажите-о-методах-жизненного-цикла-JSP.)
- [Какие методы жизненного цикла JSP могут быть переопределены?](#Какие-методы-жизненного-цикла-JSP-могут-быть-переопределены?)
- [Как можно предотвратить прямой доступ к JSP странице из браузера?](#Как-можно-предотвратить-прямой-доступ-к-JSP-странице-из-браузера?)
- [Какая разница между динамическим и статическим содержимым JSP?](#Какая-разница-между-динамическим-и-статическим-содержимым-JSP?)
- [Как закомментировать код в JSP?](#Как-закомментировать-код-в-JSP?)
- [Какие существуют основные типы тегов JSP?](#Какие-существуют-основные-типы-тегов-JSP?)
- [Что вы знаете о действиях JSP (Action tag и JSP Action Elements).](#Что-вы-знаете-о-действиях-JSP-(Action-tag-и-JSP-Action-Elements).)
- [Взаимодействие JSP - сервлет - JSP.](#Взаимодействие-"JSP-сервлет-JSP".)
- [Какие области видимости переменных существуют в JSP?](#Какие-области-видимости-переменных-существуют-в-JSP?)
- [Какие неявные, внутренние объекты и методы есть на JSP странице?](#Какие-неявные,-внутренние-объекты-и-методы-есть-на-JSP-странице?)
- [Какие неявные объекты не доступны в обычной JSP странице?](#Какие-неявные-объекты-не-доступны-в-обычной-JSP-странице?)
- [Что вы знаете о PageContext и какие преимущества его использования?](#Что-вы-знаете-о-PageContext-и-какие-преимущества-его-использования?)
- [Как сконфигурировать параметры инициализации для JSP?](#Как-сконфигурировать-параметры-инициализации-для-JSP?)
- [Почему не рекомендуется использовать скриплеты в JSP?](#Почему-не-рекомендуется-использовать-скриплеты-в-JSP?)
- [Можно ли определить класс внутри JSP страницы?](#Можно-ли-определить-класс-внутри-JSP-страницы?)
- [Что вы знаете о Языке выражений JSP (JSP Expression Language – EL)?](#Что-вы-знаете-о-Языке-выражений-JSP-(JSP-Expression-Language)?)
- [Какие типы EL операторов вы знаете?](#Какие-типы-EL-операторов-вы-знаете?)
- [Внутренние объекты JSP EL и их отличия от объектов JSP.](#Внутренние-объекты-JSP-EL-и-их-отличия-от-объектов-JSP.)
- [Как отключить возможность использования EL в JSP?](#Как-отключить-возможность-использования-EL-в-JSP?)
- [Как узнать тип HTTP метода используя JSP EL?](#Как-узнать-тип-HTTP-метода-используя-JSP-EL?)
- [Что такое JSTL (JSP Standard tag library)?](#Что-такое-JSTL-(JSP-Standard-tag-library)?)
- [Из каких групп тегов состоит библиотека JSTL?](#Из-каких-групп-тегов-состоит-библиотека-JSTL?)
- [Какая разница между <c:set> и <jsp:useBean>?](#Какая-разница-между-set-и-useBean?)
- [Как можно расширить функциональность JSP?](#Как-можно-расширить-функциональность-JSP?)
- [Что вы знаете о написании пользовательских JSP тегов?](#Что-вы-знаете-о-написании-пользовательских-JSP-тегов?)
- [Приведите пример использования собственных тегов.](#Приведите-пример-использования-собственных-тегов.)
- [Как сделать перенос строки в HTML средствами JSP?](#Как-сделать-перенос-строки-в-HTML-средствами-JSP?)
- [Почему не нужно конфигурировать стандартные JSP теги в web.xml?](#Почему-не-нужно-конфигурировать-стандартные-JSP-теги-в-web.xml?)
- [Как можно обработать ошибки JSP страниц?](#Как-можно-обработать-ошибки-JSP-страниц?)
- [Как происходит обработка ошибок с помощью JSTL?](#Как-происходит-обработка-ошибок-с-помощью-JSTL?)
- [Как конфигурируется JSP в дескрипторе развертывания.](#Как-конфигурируется-JSP-в-дескрипторе-развертывания.)
- [Можно ли использовать Javascript на JSP странице?](#Можно-ли-использовать-Javascript-на-JSP-странице?)
- [Всегда ли создается объект сессии на JSP странице, можно ли отключить его создание?](#Всегда-ли-создается-объект-сессии-на-JSP-странице,-можно-ли-отключить-его-создание?)
- [Какая разница между JSPWriter и сервлетным PrintWriter?](#Какая-разница-между-JSPWriter-и-сервлетным-PrintWriter?)
- [Опишите общие практические принципы работы с JSP.](#Опишите-общие-практические-принципы-работы-с-JSP.)

## Что такое Java Server Pages (JSP)?
__JSP (JavaServer Pages)__ — платформонезависимая переносимая и легко расширяемая технология разработки веб-приложений, 
позволяющая веб-разработчикам создавать содержимое, которое имеет как статические, так и динамические компоненты. 
Страница JSP содержит текст двух типов: статические исходные данные, которые могут быть оформлены в одном из текстовых 
форматов `HTML`, `SVG`, `WML`, или `XML`, и _JSP-элементы_, которые конструируют динамическое содержимое. Кроме этого могут 
использоваться библиотеки JSP-тегов, а также EL (Expression Language), для внедрения Java-кода в статичное 
содержимое JSP-страниц.  
Код JSP-страницы транслируется в Java-код сервлета с помощью компилятора JSP-страниц Jasper, и затем компилируется 
в байт-код JVM.   
JSP-страницы загружаются на сервере и управляются Java EE Web Application. Обычно такие страницы упакованы в 
файловые архивы .war и .jar.

## Зачем нужен JSP?
__JSP__ расширяет технологию сервлетов обеспечивая возможность создания динамических страницы с HTML подобным синтаксисом.  
Хотя создание представлений поддерживается и в сервлетах, но большая часть любой веб-страницы является статической, 
поэтому код сервлета в таком случае получается чересчур перегруженным, замусоренным и поэтому при его написании легко 
допустить ошибку.   
Еще одним преимуществом JSP является горячее развертывание - возможность заменить одну страницу на другую 
непосредственно в контейнере без необходимости перекомпилировать весь проект или перезапускать сервер.  
Однако рекомендуется избегать написания серьёзной бизнес-логики в JSP и использовать страницу только в 
качестве представления.

## Опишите, как обрабатываются JSP страницы, начиная от запроса к серверу, заканчивая ответом пользователю.
Когда пользователь переходит по ссылке на страницу `page.jsp`, он отправляет http-запрос на 
сервер `GET /page.jsp`. Затем, на основе этого запроса и текста самой страницы, сервер генерирует java-класс, 
компилирует его и выполняет полученный сервлет, формирующий ответ пользователю в виде представления этой страницы, 
который сервер и перенаправляет обратно пользователю.

## Расскажите об этапах (фазах) жизненного цикла JSP.
Если посмотреть код внутри созданной JSP страницы, то он будет выглядеть как HTML и не будет похож на java класс. 
Конвертацией JSP страниц в HTML код занимается контейнер, который так же создает и сервлет для использования 
в веб приложении.   
__Жизненный цикл JSP состоит из нескольких фаз, которыми руководит JSP контейнер:__  
+ __Translation__ – проверка и парсинг кода JSP страницы для создания кода сервлета. 
+ __Compilation__ – компиляция исходного кода сервлета.
+ __Class Loading__ – загрузка скомпилированного класса в память.
+ __Instantiation__ – внедрение конструктора без параметра загруженного класса для инициализации в памяти.
+ __Initialization__ – вызов `init()` метода объекта JSP класса и инициализация конфигурации сервлета с 
    первоначальными параметрами, которые указаны в дескрипторе развертывания (`web.xml`). После этой фазы JSP 
    способен обрабатывать запросы клиентов. Обычно эти фазы происходят после первого запроса клиента 
    (т.е. ленивая загрузка), но можно настроить загрузку и инициализацию JSP на старте приложения по аналогии 
    с сервлетами.
+ __Request Processing__ – длительный жизненный цикл обработки запросов клиента JSP страницей. Обработка является 
    многопоточной и аналогична сервлетам — для каждого запроса создается новый поток, объекты `ServletRequest` и 
    `ServletResponse`, происходит выполнение сервис методов.
+ __Destroy__ – последняя фаза жизненного цикла JSP, на которой её класс удаляется из памяти. Обычно это происходит 
    при выключении сервера или выгрузке приложения.
    
## Расскажите о методах жизненного цикла JSP.
Контейнер сервлетов (например, Tomcat, GlassFish) создает из JSP-страницы класс сервлета, наследующего свойства 
интерфейса `javax.kovteba.servlet.jsp.HttpJspBase` и включающего следующие методы:  
+ `jspInit()` — метод объявлен в JSP странице и реализуется с помощью контейнера. Этот метод вызывается один раз 
    в жизненном цикле JSP для того, чтобы инициализировать конфигурационные параметры указанные в дескрипторе 
    развертывания. Этот метод можно переопределить с помощью определения элемента _JSP scripting_ и указания 
    необходимых параметров для инициализации;
+ `_jspService()` — метод переопределяется контейнером автоматически и соответствует непосредственно коду JSP, 
    описанному на странице. Этот метод определен в интерфейсе `HttpJspPage`, его имя начинается с нижнего 
    подчеркивания и он отличается от других методов жизненного цикла тем, что его невозможно переопределить;
+ `jspDestroy()` — метод вызывается контейнером для удаления объекта из памяти (на последней фазе жизненного 
    цикла JSP - Destroy). Метод вызывается только один раз и доступен для переопределения, предоставляя возможность 
    освободить ресурсы, которые были созданы в `jspInit()`.
    
## Какие методы жизненного цикла JSP могут быть переопределены?
Возможно переопределить лишь `jspInit()` и `jspDestroy()` методы.

## Как можно предотвратить прямой доступ к JSP странице из браузера?
Прямой доступ к директории `/WEB-INF/` из веб-приложения отсутствует. Поэтому JSP-страницы можно расположить 
внутри этой папки и тем самым запретить доступ к странице из браузера. Однако, по аналогии с описанием сервлетов, 
будет необходимо настроить дескриптор развертывания:  
```xml
<servlet>
    <kovteba.servlet-name>Example</kovteba.servlet-name>
    <jsp-file>/WEB-INF/example.jsp</jsp-file>
    <init-param>
        <param-name>exampleParameter</param-name>
        <param-value>parameterValue</param-value>
    </init-param>
</servlet>
<servlet-mapping>
    <kovteba.servlet-name>Example</kovteba.servlet-name>
    <url-pattern>/example.jsp</url-pattern>
</servlet-mapping>
```

## Какая разница между динамическим и статическим содержимым JSP?
Статическое содержимое `JSP` (`HTML`, код `JavaScript`, изображения и т.д.) не изменяется в процессе работы веб приложения.   
Динамические ресурсы созданы для того, чтобы отображать свое содержимое в зависимости от пользовательских действий. 
Обычно они представлены в виде выражений EL (Expression Language), библиотек JSP-тегов и пр.  

## Как закомментировать код в JSP?
+ `<!—- HTML комментарий; отображается на странице JSP —->` такие комментарии будут видны клиенту при просмотре 
    кода страницы.
+ `<%—- JSP комментарий; не отображается на странице JSP —-%>` такие комментарии описываются в созданном сервлете 
    и не посылаются клиенту. Для любых комментариев по коду или отладочной информации необходимо использовать именно 
    такой тип комментариев.
    
## Какие существуют основные типы тегов JSP?
+ _Выражение JSP_: `<%= expression %>` - выражение, которое будет обработано с перенаправлением результата на вывод;
+ _Скриплет JSP_: `<% code %>` - код, добавляемый в метод `service()`.
+ _Объявление JSP_: `<%! code %>` - код, добавляемый в тело класса сервлета вне метода `service()`.
+ _Директива JSP page_: `<%@ page att="value" %>` - директивы для контейнера сервлетов с информацией о параметрах.
+ _Директива JSP include_: `<%@ include file="url" %>` - файл в локальной системе, подключаемый при трансляции JSP в сервлет.
+ _Комментарий JSP_: `<%-- comment --%>` - комментарий; игнорируется при трансляции JSP страницы в сервлет.

## Что вы знаете о действиях JSP (Action tag и JSP Action Elements).
__Action tag__ и __JSP Action Elements__ предоставляют методы работы с Java Beans, подключения ресурсов, проброса 
запросов и создания динамических XML элементов. Такие элементы всегда начинаются с записи `jsp:` и используются 
непосредственно внутри страницы JSP без необходимости подключения сторонних библиотек или дополнительных настроек.  
Наиболее часто используемыми JSP Action Elements являются:  
+ `jsp:include`: `<jsp:include page="относительный URL" flush="true"/>` - подключить файл при запросе страницы. 
    Если необходимо, чтобы файл подключался в процессе трансляции страницы, то используется директива `page` 
    совместно с атрибутом `include`;
+ `jsp:useBean`: `<jsp:useBean att=значение*/>` или `<jsp:useBean att=значение*>...</jsp:useBean>` - найти или 
    создать Java bean;
+ `jsp:setProperty`: `<jsp:setProperty att=значение*/>` - установить свойства Java bean, или явно, или указанием 
    на соответствующее значение, передаваемое при запросе;
+ `jsp:forward`: `<jsp:forward page="относительный URL"/>` - передать запрос другой странице;
+ `jsp:plugin`: `<jsp:plugin attribute="значение"*>...</jsp:plugin>` - сгенерировать (в зависимости от типа браузера) 
    тэги `OBJECT` или `EMBED` для апплета, использующего технологию Java Plugin.
    
## Взаимодействие "JSP сервлет JSP".
_«JSP - сервлет - JSP»_ архитектура построения приложений носит название _MVC (Model/View/Controller)_:  
+ _Model_ - классы данных и бизнес-логики;
+ _View_ - страницы JSP;
+ _Controller_ - сервлеты.

## Какие области видимости переменных существуют в JSP?
Область видимости объектов определяется тем контекстом в который помещается данный объект. В зависимости от той 
или иной области действия так же определяется время существования объекта.   
В JSP предусмотрены следующие области действия переменных (объектов):  
+ `request` область действия запроса - объект будет доступен на текущей JSP странице, странице пересылки 
    (при использовании `jsp:forward`) или на включаемой странице (при использовании `jsp:include`);
+ `session` область действия сессии - объект будет помещен в сеанс пользователя, будет доступен на всех JSP страницах 
    и будет существовать пока существует сессия пользователя, или он не будет из нее принудительно удален.
+ `application` область действия приложения - объект будет доступен для всех пользователей на всех JSP страницах и 
    будет существовать на протяжении всей работы приложения или пока не будет удален принудительно и контекста приложения.
+ `page` область действия страницы - объект будет доступен только на той странице, где он определен. На 
    включаемых (`jsp:include`) и переадресуемых (`jsp:forward`) страницах данный объект уже не будет доступен.  
Таким образом, чтобы объект был доступен всем JSP страницам, необходимо указать область видимости `application` 
или `session`, в зависимости от того требуется ли доступ к объекту всем пользователям или только текущему.  
Для указания требуемой области действия при определении объекта на JSP странице используется атрибут 
scope тега `jsp:useBean`:  
```
<jsp:useBean id="myBean" class="ru.javacore.MyBean" scope="session"/>
```  
Если не указывать атрибут `scope`, то по умолчанию задается область видимости страницы `page`

## Какие неявные, внутренние объекты и методы есть на JSP странице?
__JSP implicit objects (неявные объекты)__ создаются контейнером при конвертации JSP страницы в код сервлета для 
помощи разработчикам. Эти объекты можно использовать напрямую в скриптлетах для передачи информации в сервис методы, 
однако мы не можем использовать неявные объекты в JSP Declaration, т.к. такой код пойдет на уровень класса.  
Существует 9 видов неявных объектов, которые можно использовать прямо на JSP странице. Семь из них объявлены как 
локальные переменные в начале `_jspService()` метода, а два оставшихся могут быть использованы как аргументы 
метода `_jspService()`.  
+ `out Object` :   
```
<strong>Current Time is</strong>: <% out.print(new Date()); %><br>
```
+ `request Object`:    

```
<strong>Request User-Agent</strong>: <%=request.getHeader("User-Agent") %><br>
```
+ `response Object` :   
```
<strong>Response</strong>: <%response.addCookie(new Cookie("Test","Value")); %>
```
+ `config Object` :   
```
<strong>User init param value</strong>: <%=config.getInitParameter("User") %><br>
```
+ `application Object` :   
```
<strong>User context param value</strong>: <%=application.getInitParameter("User") %><br>
``` 
+ `session Object` :   
```
<strong>User Session ID</strong>: <%=session.getId() %><br>
```
+ `pageContext Object` :   
```
<% pageContext.setAttribute("Test", "Test Value"); %> 
<strong>PageContext attribute</strong>: {Name="Test",Value="<%=pageContext.getAttribute("Test") %>"}<br>
```
+ `page Object` :   
```
<strong>Generated Servlet Name</strong>: <%=page.getClass().getName() %>
```
+ `exception Object` :  
``` 
<strong>Exception occured</strong>: <%=exception %><br>
```

## Какие неявные объекты не доступны в обычной JSP странице?
Неявный объект исключений JSP недоступен в обычных JSP страницах и используется на страницах ошибок 
JSP (_errorpage_) только для того, чтобы перехватить исключение, выброшенное JSP страницей и далее предоставить 
какую-либо полезную информацию клиенту.

## Что вы знаете о PageContext и какие преимущества его использования?
Неявный объект JSP - экземпляр класса `javax.kovteba.servlet.jsp.PageContext` предоставляет доступ ко всем пространствам 
имён, ассоциированным с JSP-страницей, а также к различным её атрибутам.  
Остальные неявные объекты добавляются к `pageContext` автоматически.  
Класс `PageContext` это абстрактный класс, а его экземпляр можно получить через вызов метода 
`JspFactory.getPageContext()`, и освободить через вызов метода `JspFactory.releasePageContext()`.  
`PageContext` обладает следующим набором особенностей и возможностей:  
+ единый API для обслуживания пространств имён различных областей видимости;
+ несколько удобных API для доступа к различным `public`-объектам;
+ механизм получения `JspWriter` для вывода;
+ механизм обслуживания использования сессии страницей;
+ механизм экспонирования («показа») атрибутов директивы `page` среде скриптинга;
+ механизмы направления или включения текущего запроса в другие компоненты приложения;
+ механизм обработки процессов исключений на страницах ошибок _errorpage_;

## Как сконфигурировать параметры инициализации для JSP?
Параметры инициализации для JSP задаются в `web.xml` файле аналогично сервлетам - элементами `servlet` и 
`servlet-mapping`. Единственным отличием будет указание местонахождения JSP страницы: 
```xml
<servlet>
    <kovteba.servlet-name>Example</kovteba.servlet-name>
    <jsp-file>/WEB-INF/example.jsp</jsp-file>
    <init-param>
        <param-name>exampleParameter</param-name>
        <param-value>parameterValue</param-value>
    </init-param>
</servlet>
```

## Почему не рекомендуется использовать скриплеты в JSP?
JSP страницы используются в основном  для целей отображения представления (_view_), а вся бизнес-логика 
(_controller_) и модель (_model_) должны быть реализованы в сервлетах или классах-моделях. Обязанность JSP страницы - 
создание HTML ответа из переданных через атрибуты параметров. Большая часть JSP содержит HTML код а для того, чтобы 
помочь верстальщикам понять JSP код страницы предоставляется функционал элементов _action_, _JSP EL_, _JSP Standart 
Tag Library_. Именно их и необходимо использовать вместо скриптлетов для создания моста между (JSP)HTML 
и (JSP)Java частями.

## Можно ли определить класс внутри JSP страницы?
Определить класс внутри JSP страницы можно, но это считается плохой практикой:  
```java
<%!
private static class ExampleOne {
  //...
}
%>
<%
private class ExampleTwo {
  //...
}
%>
```

## Что вы знаете о Языке выражений JSP (JSP Expression Language)?
__JSP Expression Language (EL)__ — скриптовый язык выражений, который позволяет получить доступ к Java 
компонентам (JavaBeans) из JSP. Начиная с JSP 2.0 используется внутри JSP тегов для отделения Java кода 
от JSP для обеспечения лёгкого доступа к Java компонентам, уменьшая при этом количество кода Java в JSP-страницах, 
или даже полностью исключая его.  
Развитие EL происходило с целью сделать его более простым для дизайнеров, которые имеют минимальные познания 
в языке программирования Java. До появления языка выражений, JSP имел несколько специальных тегов таких как 
скриптлеты (англ.), выражения и т. п. которые позволяли записывать Java код непосредственно на странице. 
С использованием языка выражений веб-дизайнер должен знать только то, как организовать вызов 
соответствующих java-методов.  
Язык выражений JSP 2.0 включает:  
+ Создание и изменение переменных.
+ Управление потоком выполнения программы: ветвление, выполнение различных типов итераций и т.д.
+ Упрощенное обращение к встроенным JSP-объектам.
+ Возможность создавать собственные функции.  
Язык выражений используется внутри конструкции `${ ... }`. Подобная конструкция может размещаться либо отдельно, 
либо в правой части выражения установки атрибута тега. 

## Какие типы EL операторов вы знаете?
Операторы в EL поддерживают наиболее часто используемые манипуляции данными.  
Типы операторов:  
+ Стандартные операторы отношения: `==` (или `eq`), `!=` (или `neq`), `<` (или `lt`), `>` (или `gt`)
    , `<=` (или `le`), `>=` (или `ge`).
+ Арифметические операторы: `+`, `–`, `*`, `/` (или `div`), `%` (или `mod`).
+ Логические операторы: `&&` (или `and`), `||` (или `or`), `!` (или `not`).
+ Оператор `empty` – используется для проверки переменной на `null`, или «пустое значение», который зависит от 
    типа проверяемого объекта. Например, нулевая длина для строки или нулевой размер для коллекции.
    
## Внутренние объекты JSP EL и их отличия от объектов JSP.
Язык выражений JSP предоставляет множество неявных объектов, которые можно использовать для получения атрибутов 
в различных областях видимости (scopes) и для значений параметров. Важно отметить, что они отличаются от неявных 
объектов JSP и содержат атрибуты в заданной области видимости. Наиболее часто использующийся implicit object 
в JSP EL и JSP page — это объект pageContext. Ниже представлена таблица неявных объектов JSP EL.

## Как отключить возможность использования EL в JSP?
Для игнорирования выполнения языка выражений на странице существует два способа:  
+ использовать директиву `<%@ page isELIgnored = «true» %>`,
+ настроить `web.xml` (лучше подходит для отключения EL сразу на нескольких страницах):  
```xml
<jsp-config>
    <jsp-property-group>
        <url-pattern>*.jsp</url-pattern>
        <el-ignored>true</el-ignored>
    </jsp-property-group>
</jsp-config>
```

## Как узнать тип HTTP метода используя JSP EL?
`${pageContext.request.method}`.

## Что такое JSTL (JSP Standard tag library)?
__JavaServer Pages Standard Tag Library, JSTL, Стандартная библиотека тегов JSP__ — расширение спецификации 
JSP (конечный результат _JSR 52_), добавляющее библиотеку JSP тегов для общих нужд, таких как разбор XML данных, 
условная обработка, создание циклов и поддержка интернационализации.  
JSTL является альтернативой такому виду встроенной в JSP логики, как _скриплеты_ (прямые вставки Java кода). 
Использование стандартизованного множества тегов предпочтительнее, поскольку получаемый код легче поддерживать и 
проще отделять бизнес-логику от логики отображения.  
Для использования JSTL тегов необходимо:  
+ подключить зависимости, например в `pom.xml`:  
```xml
<dependency>
    <groupId>jstl</groupId>
    <artifactId>jstl</artifactId>
    <version>1.2</version>
</dependency>
<dependency>
    <groupId>taglibs</groupId>
    <artifactId>standard</artifactId>
    <version>1.1.2</version>
</dependency>
```  
+ указать пространство имен основных тегов JSTL через указание на JSP странице код:  
```
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/sql" prefix="sql" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/xml" prefix="x" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
```

## Из каких групп тегов состоит библиотека JSTL?
Группы тегов JSTL согласно их функциональности:  
+ _Core Tags_ предоставляют возможности итерации, обработки исключений, URL, _forward_, _redirect response_ и т.д.
+ _Formatting Tags_ и _Localization Tags_ предоставляют возможности по форматированию чисел, дат и поддержки _i18n_ 
    локализации и _resource bundles_.
+ _SQL Tags_ – поддержка работы с базами данных.
+ _XML Tags_ используются для работы с XML документами: парсинга, преобразования данных, выполнения 
    выражений _XPath_ и т.д..
+ _JSTL Functions Tags_ предоставляет набор функций, которые позволяют выполнять различные операции со 
    строками и т.п. Например, по конкатенации или разбиению строк.
    
## Какая разница между set и useBean? 
Оба тега создают и помещают экземпляры в заданную область видимости, но `<jsp:useBean>` только создаёт экземпляр 
конкретного типа, а `<c:set>`, создав экземпляр, позволяет дополнительно извлекать значение, например, из 
параметров запроса, сессии и т. д. 

## Как можно расширить функциональность JSP?
## Что вы знаете о написании пользовательских JSP тегов?
## Приведите пример использования собственных тегов.
JSP можно расширить с помощью создания собственных тегов с необходимой функциональностью, которые можно добавить 
в библиотеку тегов на страницу JSP указав необходимое пространство имен.  
> /WEB-INF/exampleTag.tld
```xml
<?xml version="1.0" encoding="UTF-8"?>
<taglib version="2.1" xmlns="http://java.sun.com/xml/ns/j2ee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee web-jsptaglibrary_2_1.xsd">
    <tlib-version>1.0</tlib-version>
    <short-name>example</short-name>
    <uri>/WEB-INF/exampleTag</uri>
    <tag>
        <name>exampleTag</name>
        <tag-class>xyz.company.ExampleTag</tag-class>
        <body-content>empty</body-content>
        <info>The example tag displays Hello World!</info>
    </tag>
</taglib>
```
> xyz.company.ExampleServlet.java
```java
package xyz.company;

import java.io.IOException;

import javax.kovteba.servlet.jsp.JspException;
import javax.kovteba.servlet.jsp.tagext.TagSupport;

public class ExampleTag extends TagSupport{
    private static final long serialVersionUID = 1L;

    @Override
    public int doStartTag() throws JspException {
        try {
            pageContext.getOut().print("Hello World!");
        } catch(IOException ioException) {
            throw new JspException("Error: " + ioException.getMessage());
        }       
        return SKIP_BODY;
    }
}
```
> exampleTag.jsp 
```jsp
<%@ taglib uri="/WEB-INF/exampleTag.tld" prefix="example"%>
<%@ page session="false" pageEncoding="UTF-8"%>
<html>
<head>
<title>Example Tag</title>
</head>
<body>
    <h1>Example Tag</h1>
    <p><example:exampleTage /><p>
</body>
</html>
```  
Также в пользовательских тегах существует возможность задать входные параметры. Например, существует 
необходимость отформатировать каким-либо стилем очень длинное число. Для этого можно использовать собственный 
тег по типу:  

`<mytags:formatNumber number="123456.789" format="#,## #.00"/>`  
Используя входные параметры, число должно быть преобразовано на JSP странице в таком виде `123,456.79` согласно 
шаблону. Т.к. JSTL не предоставляет такой функциональности, необходимо создать пользовательский тег для получения 
необходимого результата. 

## Как сделать перенос строки в HTML средствами JSP?
Для переноса строки можно использовать тег `c:out` и атрибут `escapeXml`, который отключает обработку 
HTML элементов. В этом случае браузер получит следующий код в виде строки и обработает элемент `<br>` как требуется:  
`<c:out value="<br> creates a new line in HTML" escapeXml="true"></c:out>`

## Почему не нужно конфигурировать стандартные JSP теги в web.xml?
Стандартные теги JSP не конфигурируются в `web.xml`, потому что tld файлы уже находятся внутри 
каталога `/META-INF/` в jar файлах JSTL.   
Когда контейнер загружает веб-приложение и находит tld файлы в в jar файле в директории `/META-INF/`, то он 
автоматически настраивает их для непосредственного использования на JSP страницах. Остается только задать 
пространство имен на JSP странице.

## Как можно обработать ошибки JSP страниц?
Для обработки исключений выброшенных на JSP странице достаточно лишь задать страницу ошибки JSP и при её 
создании установить значение _page directive attribute_ `isErrorPage` в значение `true`. Таким образом будет 
предоставлен доступ к неявным объектам исключений в JSP и появится возможность передавать собственные, более 
информативные сообщения об ошибках клиенту. При этом настройка дескриптора развертывания выглядит так:  
```xml
<error-page>
     <error-code>404</error-code>
     <location>/error.jsp</location>
</error-page>
  
<error-page>
     <exception-type>java.lang.Throwable</exception-type>
     <location>/error.jsp</location>
</error-page>
```

## Как происходит обработка ошибок с помощью JSTL?
Для перехвата и обработки исключений в служебных методах класса служат JSTL Core Tags `c:catch` и `c:if`.   
> Тег `c:catch` перехватывает исключение и обертывает его в переменную `exception`, доступную для обработки в теге `c:if`:  
```
<c:catch var ="exception">
   <% int x = 42/0;%>
</c:catch>  
<c:if test = "${exception ne null}">
   <p>Exception is : ${exception} <br />
   Exception Message: ${exception.message}</p>
</c:if>
```
Обратите внимание что используется язык выражений JSP EL в теге `c:if`.  

## Как конфигурируется JSP в дескрипторе развертывания.
Для настройки различных параметров JSP страниц используется элемент `jsp-config`, который отвечает за:  
+ управление элементами скриптлетов на странице;
+ управления выполнением в языке выражений;
+ определение шаблона URL для encoding;
+ определение размера буфера, который используется для объектов на странице;
+ обозначение групп ресурсов, соответствующих шаблону URL, которые должны быть обработаны как XML документ.  
```xml
<jsp-config>
    <taglib>
        <taglib-uri>http://company.xyz/jsp/tlds/customtags</taglib-uri>
        <taglib-location>/WEB-INF/exampleTag.tld</taglib-location>
    </taglib>
</jsp-config>
```

## Можно ли использовать Javascript на JSP странице?
Да, это возможно. Несмотря на то, что JSP это серверная технология, на выходе она всё равно создает `HTML` страницу, 
на которую можно добавлять Javascript и CSS.  

## Всегда ли создается объект сессии на JSP странице, можно ли отключить его создание?
Jsp-страница, по умолчанию, всегда создает сессию. Используя директиву `page` с атрибутом `session` можно 
изменить это поведение:  
`<%@ page session ="false" %>`

## Какая разница между JSPWriter и сервлетным PrintWriter?
`PrintWriter` является объектом отвечающим за запись содержания ответа на запрос. `JspWriter` использует 
объект `PrintWriter` для буферизации. Когда буфер заполняется или сбрасывается, `JspWriter` использует 
объект `PrintWriter` для записи содержания в ответ.  

## Опишите общие практические принципы работы с JSP.
Хорошей практикой работы с технологией JSP является соблюдение следующих правил:

+ Следует избегать использования элементов скриптлетов на странице. Если элементы _action_, _JSTL_, _JSP EL_ не 
    удовлетворяют потребностям, то желательно написать собственный тег.
+ Рекомендуется использовать разные виды комментариев: так JSP комментарии необходимы для уровня кода и отладки, т.к. 
    они не будут показаны клиенту.
+ Не стоит размещать какой-либо бизнес логики внутри JSP страницы. Страницы должны использоваться только для 
    создания ответов клиенту.
+ Для повышения производительности лучше отключать создание сессии на странице, когда это не требуется.
+ Директивы `taglib`, `page` в начале JSP страницы улучшают читабельность кода.
+ Следует правильно использовать директиву `include` и элемент `jsp:include action`. Первая используется для 
    статических ресурсов, а второй для динамических ресурсов времени выполнения.
+ Обработку исключений нужно производить с помощью страниц ошибок. Это помогает избегать запуска специальных 
    служебных методов и может повысить производительность.
+ Использующиеся CSS и JavaScript должны быть разнесены в разные файлы и подключаться в начале страницы.
+ В большинстве случаев JSTL должно хватать для всех нужд. Если это не так, то в начале следует проанализировать 
    логику своего приложения, и попробовать перенести выполнения кода в сервлет, а далее с помощью установки 
    атрибутов использовать на JSP странице только результат.